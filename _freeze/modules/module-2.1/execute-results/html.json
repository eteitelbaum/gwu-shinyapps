{
  "hash": "a32df728cc5e0a1f158c4eb085ac60b0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Module 2.1\"\nsubtitle: \"Line Chart App Setup\"\nformat: \n  html:\n    code-link: true\nhighlight-style: atom-one\nexecute:\n  echo: true\n  message: false\n  warning: false\n---\n\n\n:::{.callout-tip}\n## Prework\n- Get a [FRED API key](https://fred.stlouisfed.org/docs/api/api_key.html)\n- Install [fredr](https://cran.r-project.org/web/packages/fredr/vignettes/fredr.html), read about its basic usage and have a look at the [FRED](https://fred.stlouisfed.org/) website\n- Install [ecm](https://cran.r-project.org/web/packages/ecm/ecm.pdf), which we will use to build our recession shading helper script\n- Install [shinyWidgets](https://dreamrs.github.io/shinyWidgets/) and familiarize yourself with its basic functions\n- Start a new Shiny project for this lesson. Go to File, select New Directory and then Shiny App. Browse to where you want to save the app, give the directory a name and click Create Project. \n- Read [this article](https://shiny.posit.co/r/articles/build/sliders/) about sliders\n:::\n\n## Overview\n\nA fundmental concept in R Shiny is reactivity. Reactivity refers to the automatic responsiveness and dynamic behavior of the application based on user input and data changes. It allows the application to update and re-render specific parts of the user interface (UI) in response to changes in input values, data updates, or other reactive triggers.\n\nAll Shiny apps have an element of reactivity. In a basic Shiny app like we say in the last module, reactivity occurs when user input is fed to the server function through functions like `renderPlot()` or `renderTable()`. But we might also want to add additional elements of reactivity by using reactive functions like `reactive()` or `observe()`. \n\nThe app that we are going to build over the next few modules is going to look at how to use the `reactive()` function to control two separate reactive inputs to a line chart: the indicator the user wishes to view and the date range that the way to view it for. Here is the app that we are going to be building:\n\n<iframe src=\"https://emmanuelteitelbaum.shinyapps.io/fred_app/\" width=\"780\" height=\"560\" data-external=\"1\"></iframe>\n\n## Setup\n\n{{< video https://youtu.be/2qAoOWLkdcc title = 'FRED App set up'>}}\n\nIn the setup portion of our we want to start by loading the packages we will need to build the app. For this app, we are going to be using the `fredr` package to download data pertaining to the overall health of the economy from the St. Louis Fed's Federal Reserve Economic Data (FRED)[https://fred.stlouisfed.org/] API. So here we will also set our FRED API key and assign the codes for the indicators that we want to download to objects. \n\nNext, we will use the `as.Date()` function to set the start date of our line series to Januar 1, 1970 and the end date as today's date (system date). We will also create a list of variable names for our UI dropdown (`vars`) and relate them to the objects containing the indicator codes. \n\nFinally, we are going to be using a helper function to generate recession shading for our charts. Scroll down to the bottom of this page to see the code for the helper function. Take this and save it in an R file and put it in your app folder. In this chunk, we are going to call it with the source function, e.g. `source(helper.R)`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load packages\nlibrary(shiny)\nlibrary(fredr)\nlibrary(dplyr)\nlibrary(ggplot2)\n\n# Set Fred API key \nfredr_set_key(\"YOUR FRED API KEY\") \n\n# Assign FRED series to objects\ncci <- \"CSCICP03USM665S\" # consumer confidence\nbci <- \"BSCICP03USM665S\" # business confidence\ncli <- \"USALOLITONOSTSAM\" # composite lead indicator\nunemp_rate <- \"UNRATE\" # unemployment rate\ngrowth <- \"A191RL1Q225SBEA\" # growth rate\n\n# set start and end date\nstart_date <- as.Date(\"1970-01-01\")\nend_date <- as.Date(Sys.Date())\n\n# Create list of named values for the input selection\nvars <- c(\"Consumer Confidence\" = cci, \n          \"Business Confidence\" = bci, \n          \"Composite Indicator\" = cli, \n          \"Unemployment Rate\" = unemp_rate,\n          \"Growth Rate\" = growth)\n\n# Load helper script\nsource(\"helper.R\") # scroll down, code pasted below\n```\n:::\n\n\n## Helper script\n\nThis is the helper script for shaded recession rectangles. Save in a file called `helper.R` in same folder as your `app.R` file. See [this post](https://rpubs.com/FSl/609471) for more details. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ecm) # forlagpad\n\n# define add_rec_shade function\nadd_rec_shade<-function(st_date,ed_date,shade_color, y_min, y_max) {\n  \n  # download NBER recession indicators, peak through trough\n  recession<- fredr(series_id = \"USRECD\",\n                    observation_start = as.Date(st_date), \n                    observation_end = as.Date(ed_date))\n  \n  #code 1 for 1st day of recession, -1 for 1st day after it ends\n  recession$diff<-recession$value-lagpad(recession$value,k=1)\n  \n  #drop 1st N.A. value\n  recession<-recession[!is.na(recession$diff),] \n  \n  #create vector of recession start dates\n  recession.start<-recession[recession$diff==1,]$date \n  \n  #create vector of recession end dates\n  recession.end<-recession[recession$diff==(-1),]$date \n  \n  # if there are more dates listed in recession.start than recession.end\n  if(length(recession.start)>length(recession.end))\n  # then enter system date for last date in recession.end\n  {recession.end<-c(recession.end,Sys.Date())} \n  \n  # if there are more dates listed in recession.end than recession.start\n  if(length(recession.end)>length(recession.start))       \n  # then enter the earliest date in recession$date as first date in recession.start  \n  {recession.start<-c(min(recession$date),recession.start)} \n  \n  # make a dataframe out of recession.start and recession.end\n  recs<-as.data.frame(cbind(recession.start,recession.end))\n  \n  # convert recession.start into a date\n  recs$recession.start<-as.Date(\n    as.numeric(recs$recession.start),\n    origin=as.Date(\"1970-01-01\")) \n\n  # convert recession.end into a date\n  recs$recession.end<-as.Date(\n    recs$recession.end,\n    origin=as.Date(\"1970-01-01\")) \n  \n  # if the number of rows in recs > 0\n  if(nrow(recs)>0) \n  # draw the rectangle  \n  {rec_shade<-geom_rect(data=recs, \n                         # inherit.aes=F overrides default aesthetics\n                         inherit.aes=F, \n                         aes(xmin=recession.start, \n                         xmax=recession.end, \n                         ymin=y_min, ymax=y_max), \n                         fill=shade_color, alpha=0.5)\n    return(rec_shade)\n  }\n}\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}